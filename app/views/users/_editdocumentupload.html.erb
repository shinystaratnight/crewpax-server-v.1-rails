<div class="panel panel-default" id="nested">  
  <div class="panel-heading" role="tab" id="heading_document_board"> 
    <h3 class="panel-title" id="upload_file_title">
      <a role="button" data-toggle="collapse" data-parent="#accordion" href="#document_board" aria-expanded="false" aria-controls="document_board">Documents</a>
    </h3>
  </div>
  <div id="document_board" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading_document_board">
    <div class="alert alert-success alert-dismissible" hidden="true" role="alert" id="success_msg"></div>
    <div class="alert alert-danger alert-dismissible"  role="alert" hidden="true" id="fail_msg"></div>
    <div class="alert alert-success alert-dismissible" hidden="true" role="alert" id="success_new_client_msg"></div>
    <div class="alert alert-danger alert-dismissible" hidden="true" role="alert" id="fail_new_client_msg"></div>
    <% resume_attachments = @attachments.find_all{|file| file.type ==  "Resume"}%>
    <% noa_attachments = @attachments.find_all{|file| file.type ==  "NOA"}%>
    <% driver_attachments = @attachments.find_all{|file| file.type ==  "Drivers_License"}%>
    <% other_attachments = @attachments.find_all{|file| file.type ==  "other"} %>
<!--When a user refreshes a page, server will render uploaded files from database  -->
    <% if resume_attachments.present? %> 
      <% resume_attachments.map{|resume| %> 
        <span id="edit_resume">
          <div class="uploaded_file" data-file-type="Resume" data-clickable="">          
            <a data-toggle="collapse" data-parent="#nested" href="#collapseSix" aria-expanded="false" aria-controls="collapseSix" class="multiple_email">  
              <label class="file_info" class="file_info" data-file-id="<%=resume.id%>">
                <i class="fa fa-file-pdf-o" style="font-size: 50px; color:black;"></i>
                </br>
                Resume
              </label>
            </a>
            <a href="<%=resume.file_share_link%>" class="share_link"><i class="fa fa-paperclip" style="font-size: 20px; color: gray;"></i></a> 
            <span class="resume_delete"><i class="fa fa-times" aria-hidden="true" style="color: #d9534f; font-size: 18px; cursor:pointer;" data-attachment-id="<%=resume.id%>"></i></span>
          </div>
        </span>    
        <span id="resume_deleting" hidden="true"><i class="fa fa-spinner fa-spin" style="font-size: 40px; color: gray;"></i></span>  
        <span id="resume_delete_completed" hidden="true"><i class="fa fa-check-circle" style="font-size: 40px; color:green"></i></span>        
        
      <% } %>
    <% end %> 

    <% if noa_attachments.present? %>
      <% noa_attachments.map{|noa| %>
        <span id="edit_noa"> 
          <div class="uploaded_file" data-file-type="NOA" data-clickable="">         
            <a data-toggle="collapse" data-parent="#nested" href="#collapseSix" aria-expanded="false" aria-controls="collapseSix" class="multiple_email">   
              <label for="file_pdf" class="file_info" data-file-id="<%=noa.id%>">
                <i class="fa fa-file-pdf-o" id="file_pdf" style="font-size: 50px; color:black;"></i>
                </br> 
                NOA
              </label>
            </a>    
            <a href="<%=noa.file_share_link%>" class="share_link"><i class="fa fa-paperclip" style="font-size: 20px; color: gray; margin-left: -15px;"></i></a> 
            <span class="noa_delete"><i class="fa fa-times" aria-hidden="true" style="color: #d9534f; font-size: 18px; cursor:pointer;" data-attachment-id="<%=noa.id%>"></i></span>    
          </div>
        </span>
        <span id="noa_deleting" hidden="true"><i class="fa fa-spinner fa-spin" style="font-size: 40px; color: gray;"></i></span>  
        <span id="noa_delete_completed" hidden="true"><i class="fa fa-check-circle" style="font-size: 40px; color:green"></i></span> 
      <% } %>
    <% end %>    

    <% if driver_attachments.present? %> 
      <% driver_attachments.map {|driver| %>
        <span id="edit_driver">          
          <div class="uploaded_file" data-file-type="Drivers_License" data-clickable=""> 
            <a data-toggle="collapse" data-parent="#nested" href="#collapseSix" aria-expanded="false" aria-controls="collapseSix" class="multiple_email">
            <label class="file_info" data-file-id="<%=driver.id%>">
              <i class="fa fa-file-pdf-o" style="font-size: 50px; margin-left: 25px; color:black;"></i>
              </br>
              Driver's License
            </label>
            </a>
            <a href="<%=driver.file_share_link %>" class="share_link"><i class="fa fa-paperclip" style="font-size: 20px; color: gray;"></i></a>
            <span class="driver_delete"><i class="fa fa-times" aria-hidden="true" style="color: #d9534f; font-size: 18px; cursor:pointer;" data-attachment-id="<%=driver.id%>"></i></span> 
          </div>
        </span>
        <span id="driver_deleting" hidden="true"><i class="fa fa-spinner fa-spin" style="font-size: 40px; color: gray;"></i></span>  
        <span id="driver_delete_completed" hidden="true"><i class="fa fa-check-circle" style="font-size: 40px; color:green"></i></span> 
      <% } %>
    <% end %>

    <% if other_attachments.present? %>  
      <% other_attachments.map {|other| %>
        <span id="edit_other">      
          <div class="uploaded_file" data-file-type="other" data-clickable="">       
            <a data-toggle="collapse" data-parent="#nested" href="#collapseSix" aria-expanded="false" aria-controls="collapseSix" class="multiple_email">  
            <label class="file_info" data-file-id="<%=other.id%>">
              <i class="fa fa-file-pdf-o" style="font-size: 50px;color:black;"></i>
              </br>
              Other
            </label>
            </a>
            <a href="<%=other.file_share_link %>" class="share_link"><i class="fa fa-paperclip" style="font-size: 20px; color: gray;"></i></a>
            <span class="other_delete"><i class="fa fa-times" aria-hidden="true" style="color: #d9534f; font-size: 18px; cursor:pointer;" data-attachment-id="<%=other.id%>"></i></span>       
          </div>
        </span>
        <span id="other_deleting" hidden="true"><i class="fa fa-spinner fa-spin" style="font-size: 40px; color: gray;"></i></span>  
        <span id="other_delete_completed" hidden="true"><i class="fa fa-check-circle" style="font-size: 40px; color:green"></i></span> 
      <% } %>
    <% end %>
      
<!--User doesn't have any uploaded files, and user edit(add/delete) files on the edit page using ajax  -->    
  <span id="new_uploaded_file"></span> 
    <span id="document_template" hidden="true">
      <div class="uploaded_file" data-file-type="" data-clickable="">          
        <a data-toggle="collapse" data-parent="#nested" href="#collapseSix" aria-expanded="false" aria-controls="collapseThree" class="multiple_email">  
          <label class="file_info" id="document_info" data-file-id="">
            <i class="fa fa-file-pdf-o" style="font-size: 50px; color:black;"></i>
            </br>
            <p id="document_name"></p>
          </label>
        </a>
        <a href="" class="document_share_link"><i class="fa fa-paperclip" style="font-size: 20px; color: gray;"></i></a> 
        <span class="ajax_document_delete"><i class="fa fa-times" style="color: #d9534f; font-size: 18px; cursor:pointer;" data-attachment-id=""></i></span>
      </div>
    </span>    
    <span id="ajax_document_deleting" hidden="true"><i class="fa fa-spinner fa-spin" style="font-size: 40px; color: gray;"></i></span>  
    <span id="document_delete_completed" hidden="true"><i class="fa fa-check-circle" style="font-size: 40px; color:green"></i></span>
     
    

    <div id="collapseSix" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingSix">
      <%= render 'emailForm' %>
    </div>

    </br>
   
      <a role="button" class="btn btn-primary" id="upload_new_documents_button" data-toggle="collapse" data-parent="#nested" href="#upload_new_documents" aria-expanded="false" aria-controls="upload_new_documents">Upload new documents</a>


    


    <div id="upload_new_documents" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading_upload_new_documents">
      <form id="new_file_upload_form" class="form-inline" method="post" action="/attachments" nctype="multipart/form-data" data-attachment-id="">
        <div class="form-group" class="file_upload">
          <label for="client_email" class="document_email"> Recipient's email address:</label>
          <input type="text" class="client_email" name="client_email" id="recipient_email"> 
        </div>

        <div class="form-group" class="file_upload">
          <label for="upload_file"  class="document_email"> File: </label> 
          <input id="upload_file" type="file" name="file">
        </div>

        <div class="form-group" class="file_upload">
        <label class="document_email">Type of the attachment: </label>  
          <select id="selected_file">
            <option value="Resume">Resume</option>
            <option value="NOA">NOA</option>
            <option value="Drivers_License">Drivers License</option>
            <option value="other"> Other </option>
          </select>
        </div>          
        <button class="btn btn-primary" id="submit_button"><i class="fa fa-envelope-o"></i> Email</button>
        <span id="uploading" hidden="true">
          <i class="fa fa-spinner fa-spin" style="font-size: 40px; color: gray;"></i>  
        </span>       
        <span id="success_upload" hidden="true">
          <i class="fa fa-check-circle" style="font-size: 40px; color:green"></i>
        </span>         
      </form>       
    </div>
  </div>
</div>
