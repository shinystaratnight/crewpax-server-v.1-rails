function ajaxEditAddCertifiable(e){var t=$("#info").data("user-id");$.ajax({url:"/certifiables",method:"post",dataType:"json",data:{certifiable:{user_id:t,certificate_id:e}},success:function(){}})}function ajaxEditDeleteCertifiable(e,t){var a=$("#info").data("user-id");$.ajax({url:"/certifiables/"+t,method:"delete",dataType:"json",data:{certifiable:{user_id:a,id:t,certificate_id:e}},success:function(){}})}function ajaxDeleteNewDocument(e,t){var a=$("#info").data("user-id");$.ajax({url:"/attachments/"+e,method:"delete",dataType:"json",data:{attachment:{id:e,user_id:a}},success:function(e){e===undefined&&($(t).hide(),$("#success_msg").text("File has been successfully deleted.").show().delay(3e3).fadeOut(1e3),$(this).parents("span").remove())}})}function resetDocumentDataAttr(e){$.each($(e),function(e,t){$(t).data("clickable",""),$(this).find(".file_info").removeClass("selected_document"),$(this).find(".file_info").find("i").css({color:"black"})})}function labelSeletedDocument(e){$.each($(e),function(e,t){"true"==$(t).data("clickable")&&($(this).find(".file_info").find("i").css({color:"#5cb85c"}),$(this).find(".file_info").addClass("selected_document"))})}$(function(){$(".chosen-select").chosen({width:"100%"});var e=$(".chosen-select").find("option:selected");$("#edit-certificate").on("change",function(t,a){var i=a.selected,n=a.deselected;i>0?ajaxEditAddCertifiable(i):n>0&&$.map($(e),function(e){if($(e).val()==n){var t=$(e).data("certifiable-id");ajaxEditDeleteCertifiable(n,t)}})}),$("#new_file_upload_form").on("submit",function(e){var t=$("#recipient_email").val().trim(),a=$("#info").data("user-id"),i=$("#selected_file :selected").val(),n=new FormData;if($input=$("#upload_file"),0==$input[0].files.length)return $("#fail_msg").text("Attachment can't be blank, please choose your file").show().delay(3e3).fadeOut(1e3),!1;if(""==t)return $("#fail_msg").text("Recipient email can't be blank").show().delay(3e3).fadeOut(1e3),!1;var d=$input[0].files[0].name,l=a+"_"+i+"_"+d;n.append("attachment[file]",$input[0].files[0]),$("#fail_msg").hide(),e.preventDefault(),$("#submit_button").hide(),$("#uploading").show(),$.ajax({url:"/attachments",method:"post",dataType:"json",data:{attachment:{user_id:a,type:i,name:l,file:"null",client_email:t}},success:function(e){$("#selected_file :selected").data("attachment-id",e.id);var t=$("#selected_file :selected").data("attachment-id");e.id>0?$.ajax({url:"/attachments/"+t,method:"put",dataType:"json",data:n,cache:!1,contentType:!1,processData:!1,success:function(e){if(e.file_share_link===undefined)$("#fail_msg").text(e).show().delay(3e3).fadeOut(1e3),$("#uploading").hide(),$("#submit_button").show();else{$("#success_upload").show().delay(3e3).fadeOut(1e3),$("#uploading").hide(),$("#submit_button").show();var t=$("#document_template").clone();t.find("#document_info").data("file-id",e.id),t.find("#document_name").text(e.type),t.find(".ajax_document_delete").data("attachment-id",e.id),t.find(".document_share_link").attr("href",e.file_share_link),$("#new_uploaded_file").append(t.show()),$("#success_msg").text(e.type+" has been sent to "+e.client_email+".").show().delay(3e3).fadeOut(1e3)}}}):($("#fail_msg").text(e).show().delay(3e3).fadeOut(1e3),$("#uploading").hide(),$("#submit_button").show())}})}),$("#new_uploaded_file").on("click",".ajax_document_delete",function(){$(this).parentsUntil("#document_template").hide(),$("#ajax_document_deleting").show(),ajaxDeleteNewDocument($(this).data("attachment-id"),$("#ajax_document_deleting"),$(this))}),$(".resume_delete").on("click",function(){$(this).parents("span").hide(),$("#resume_deleting").show(),ajaxDeleteNewDocument($(this).children().data("attachment-id"),$("#resume_deleting"),$(this))}),$(".noa_delete").on("click",function(){$(this).parents("span").hide(),$("#noa_deleting").show(),ajaxDeleteNewDocument($(this).children().data("attachment-id"),$("#noa_deleting"),$(this))}),$(".driver_delete").on("click",function(){$(this).parents("span").hide(),$("#driver_deleting").show(),ajaxDeleteNewDocument($(this).children().data("attachment-id"),$("#driver_deleting"),$(this))}),$(".other_delete").on("click",function(){$(this).parents("span").hide(),$("#other_deleting").show(),ajaxDeleteNewDocument($(this).children().data("attachment-id"),$("#other_deleting"),$(this))}),$(".uploaded_file").on("click",function(){$.each($(".uploaded_file"),function(e,t){$(t).data("clickable",""),$(this).find(".file_info").removeClass("selected_document"),$(this).find(".file_info").find("i").css({color:"black"})}),$(this).data("clickable","true"),labelSeletedDocument($(".uploaded_file"))}),$("#new_uploaded_file").on("click",".uploaded_file",function(){resetDocumentDataAttr($("#new_uploaded_file .uploaded_file")),resetDocumentDataAttr($(".uploaded_file")),$(this).data("clickable","true"),labelSeletedDocument($(this))}),$("#email_new_form").on("submit",function(e){var t=$("#new_client_email").val().trim();if(""==t)return $("#fail_new_client_msg").text("Recipient email can't be blank").show().delay(3e3).fadeOut(1e3),!1;e.preventDefault(),$("#email_sent").hide(),$("#sending").show(),$.each($(".uploaded_file"),function(){if("true"==$(this).data("clickable")){var e=$(this).find(".file_info").data("file-id");$(this);$.ajax({url:"/attachments/"+e,method:"put",dataType:"json",data:{attachment:{client_email:t}},success:function(e){e.id>0?($("#email_sent").show(),$("#sending").hide(),$("#success_new_client_msg").text(e.type+" has been successfully sent to "+e.client_email+".").show().delay(3e3).fadeOut(1e3)):($("#fail_new_client_msg").text(e).show().delay(3e3).fadeOut(1e3),$("#sending").hide(),$("#email_sent").show())}})}})})});